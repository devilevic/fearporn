<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>fearporn</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/style.css" />
</head>

<body class="theme-dark">

  <!-- HEADER -->
  <header>
    <div class="header-inner">
      <div class="header-row">
        <div>
          <h1>fearporn</h1>
          <div class="tagline">bringing the worst humanity has to offer</div>
        </div>

        <button class="theme-toggle" type="button" onclick="toggleTheme()">
          <span class="theme-icon">üåô</span>
          <span class="theme-label">dark</span>
        </button>
      </div>
    </div>
  </header>

  <!-- FEED -->
  <main id="feed"></main>

  <!-- SCRIPT -->
  <script>
    function toggleTheme() {
      const body = document.body;
      const icon = document.querySelector(".theme-icon");
      const label = document.querySelector(".theme-label");

      const isDark = body.classList.contains("theme-dark");

      body.classList.toggle("theme-dark", !isDark);
      body.classList.toggle("theme-light", isDark);

      if (isDark) {
        icon.textContent = "‚òÄÔ∏è";
        label.textContent = "light";
      } else {
        icon.textContent = "üåô";
        label.textContent = "dark";
      }
    }

    function formatDate(value) {
      if (!value) return "";
      const d = new Date(value);
      if (isNaN(d)) return "";
      return d.toLocaleString("en-GB", {
        day: "2-digit",
        month: "short",
        hour: "2-digit",
        minute: "2-digit"
      });
    }

    async function load() {
      const res = await fetch("/api/articles");
      const articles = await res.json();

      const feed = document.getElementById("feed");

      if (!articles.length) {
        feed.innerHTML = "<p>No summarized articles yet.</p>";
        return;
      }

      feed.innerHTML = articles.map(a => `
        <article class="card">
          <div class="meta">
            ${a.category || "world"} ‚Ä¢ ${formatDate(a.summarized_at)}
          </div>

          <h2 class="title">${a.title || ""}</h2>

          <div class="summary">${a.summary || ""}</div>

          <div class="source">
            Source:
            <a href="${a.url}" target="_blank" rel="noopener">
              ${a.source_domain || "source"}
            </a>
          </div>
        </article>
      `).join("");
    }

    load();
  </script>

</body>
</html>